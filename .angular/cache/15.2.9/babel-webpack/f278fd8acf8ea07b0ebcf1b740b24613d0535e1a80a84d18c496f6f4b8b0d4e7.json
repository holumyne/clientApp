{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/basket/basket.service\";\nimport * as i2 from \"../checkout.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"../../shared/components/text-input/text-input.component\";\nimport * as i8 from \"@angular/cdk/stepper\";\nconst _c0 = [\"cardNumber\"];\nconst _c1 = [\"cardExpiry\"];\nconst _c2 = [\"cardCvc\"];\nfunction CheckoutPaymentComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7)(2, \"div\", 8);\n    i0.ɵɵelement(3, \"app-text-input\", 9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 10)(5, \"div\", 11)(6, \"div\", 12);\n    i0.ɵɵelement(7, \"div\", 13, 14);\n    i0.ɵɵelementStart(9, \"label\");\n    i0.ɵɵtext(10, \"Card Number\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"div\", 15)(12, \"div\", 12);\n    i0.ɵɵelement(13, \"div\", 13, 16);\n    i0.ɵɵelementStart(15, \"label\");\n    i0.ɵɵtext(16, \"Card Expiry\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(17, \"div\", 15)(18, \"div\", 12);\n    i0.ɵɵelement(19, \"div\", 13, 17);\n    i0.ɵɵelementStart(21, \"label\");\n    i0.ɵɵtext(22, \"Card CVC\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.checkoutForm);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"label\", \"Name on card\");\n  }\n}\nexport class CheckoutPaymentComponent {\n  constructor(basketService, checkoutService, toastr, router) {\n    this.basketService = basketService;\n    this.checkoutService = checkoutService;\n    this.toastr = toastr;\n    this.router = router;\n    this.stripe = null;\n    this.cardNumberComplete = false;\n    this.cardExpiryComplete = false;\n    this.cardCvcComplete = false;\n    this.loading = false;\n  }\n  submitOrder() {\n    const basket = this.basketService.getCurrentBasketValue();\n    if (!basket) return;\n    const orderToCreate = this.getOrderToCreate(basket);\n    if (!orderToCreate) return;\n    this.checkoutService.createOrder(orderToCreate).subscribe({\n      next: order => {\n        this.toastr.success('Order created successfully');\n        this.basketService.deleteLocalBasket();\n        const navigationExtras = {\n          state: order\n        };\n        this.router.navigate(['checkout/success'], navigationExtras);\n      }\n    });\n  }\n  getOrderToCreate(basket) {\n    const deliveryMethodId = this.checkoutForm?.get('deliveryForm')?.get('deliveryMethod')?.value;\n    const shipToAddress = this.checkoutForm?.get('addressForm')?.value;\n    if (!deliveryMethodId || !shipToAddress) return;\n    return {\n      basketId: basket.id,\n      deliveryMethodId: deliveryMethodId,\n      shipToAddress: shipToAddress\n    };\n  }\n}\nCheckoutPaymentComponent.ɵfac = function CheckoutPaymentComponent_Factory(t) {\n  return new (t || CheckoutPaymentComponent)(i0.ɵɵdirectiveInject(i1.BasketService), i0.ɵɵdirectiveInject(i2.CheckoutService), i0.ɵɵdirectiveInject(i3.ToastrService), i0.ɵɵdirectiveInject(i4.Router));\n};\nCheckoutPaymentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CheckoutPaymentComponent,\n  selectors: [[\"app-checkout-payment\"]],\n  viewQuery: function CheckoutPaymentComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n      i0.ɵɵviewQuery(_c1, 5);\n      i0.ɵɵviewQuery(_c2, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.cardNumberElement = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.cardExpiryElement = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.cardCvcElement = _t.first);\n    }\n  },\n  inputs: {\n    checkoutForm: \"checkoutForm\"\n  },\n  decls: 8,\n  vars: 1,\n  consts: [[\"class\", \"mt-4\", 3, \"formGroup\", 4, \"ngIf\"], [1, \"d-flex\", \"justify-content-between\", \"flex-row\", \"mt-3\"], [\"cdkStepperPrevious\", \"\", 1, \"btn\", \"btn-outline-primary\"], [1, \"fa\", \"fa-angle-left\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"fa\", \"fa-angle-right\"], [1, \"mt-4\", 3, \"formGroup\"], [1, \"row\"], [\"formGroupName\", \"paymentForm\", 1, \"form-group\", \"col-12\"], [\"formControlName\", \"nameOnCard\", 3, \"label\"], [1, \"row\", \"mb-3\"], [1, \"col-6\"], [1, \"form-floating\"], [1, \"form-control\"], [\"cardNumber\", \"\"], [1, \"col-3\"], [\"cardExpiry\", \"\"], [\"cardCvc\", \"\"]],\n  template: function CheckoutPaymentComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, CheckoutPaymentComponent_div_0_Template, 23, 2, \"div\", 0);\n      i0.ɵɵelementStart(1, \"div\", 1)(2, \"button\", 2);\n      i0.ɵɵelement(3, \"i\", 3);\n      i0.ɵɵtext(4, \" Back to review \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function CheckoutPaymentComponent_Template_button_click_5_listener() {\n        return ctx.submitOrder();\n      });\n      i0.ɵɵtext(6, \" Submit order \");\n      i0.ɵɵelement(7, \"i\", 5);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.checkoutForm);\n    }\n  },\n  dependencies: [i5.NgIf, i6.NgControlStatus, i6.NgControlStatusGroup, i6.FormGroupDirective, i6.FormControlName, i6.FormGroupName, i7.TextInputComponent, i8.CdkStepperPrevious],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":";;;;;;;;;;;;;;IAAAA,8BAAkE;IAGtDA,oCAAuF;IAC3FA,iBAAM;IAEVA,+BAAsB;IAGVA,8BAA4C;IAC5CA,6BAAO;IAAAA,4BAAW;IAAAA,iBAAQ;IAIlCA,gCAAmB;IAEXA,+BAA4C;IAC5CA,8BAAO;IAAAA,4BAAW;IAAAA,iBAAQ;IAGlCA,gCAAmB;IAEXA,+BAAyC;IACzCA,8BAAO;IAAAA,yBAAQ;IAAAA,iBAAQ;;;;IAvBAA,+CAA0B;IAGrCA,eAAwB;IAAxBA,sCAAwB;;;ACapD,OAAM,MAAOC,wBAAwB;EAgBnCC,YAAoBC,aAA4B,EAAUC,eAAgC,EAChFC,MAAqB,EAAUC,MAAc;IADnC,kBAAa,GAAbH,aAAa;IAAyB,oBAAe,GAAfC,eAAe;IAC/D,WAAM,GAANC,MAAM;IAAyB,WAAM,GAANC,MAAM;IAZ/C,WAAM,GAAkB,IAAI;IAI5B,uBAAkB,GAAG,KAAK;IAC1B,uBAAkB,GAAG,KAAK;IAC1B,oBAAe,GAAG,KAAK;IAEvB,YAAO,GAAG,KAAK;EAI4C;EAE3DC,WAAW;IACT,MAAMC,MAAM,GAAG,IAAI,CAACL,aAAa,CAACM,qBAAqB,EAAE;IACzD,IAAI,CAACD,MAAM,EAAE;IACb,MAAME,aAAa,GAAG,IAAI,CAACC,gBAAgB,CAACH,MAAM,CAAC;IACnD,IAAG,CAACE,aAAa,EAAE;IACnB,IAAI,CAACN,eAAe,CAACQ,WAAW,CAACF,aAAa,CAAC,CAACG,SAAS,CAAC;MACxDC,IAAI,EAAEC,KAAK,IAAG;QACZ,IAAI,CAACV,MAAM,CAACW,OAAO,CAAC,4BAA4B,CAAC;QACjD,IAAI,CAACb,aAAa,CAACc,iBAAiB,EAAE;QACtC,MAAMC,gBAAgB,GAAqB;UAACC,KAAK,EAAEJ;QAAK,CAAC;QACzD,IAAI,CAACT,MAAM,CAACc,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAAEF,gBAAgB,CAAC;MAC9D;KACD,CAAC;EACJ;EAEQP,gBAAgB,CAACH,MAAc;IACrC,MAAMa,gBAAgB,GAAG,IAAI,CAACC,YAAY,EAAEC,GAAG,CAAC,cAAc,CAAC,EAAEA,GAAG,CAAC,gBAAgB,CAAC,EAAEC,KAAK;IAC7F,MAAMC,aAAa,GAAG,IAAI,CAACH,YAAY,EAAEC,GAAG,CAAC,aAAa,CAAC,EAAEC,KAAgB;IAC7E,IAAI,CAACH,gBAAgB,IAAI,CAACI,aAAa,EAAE;IACzC,OAAO;MACLC,QAAQ,EAAElB,MAAM,CAACmB,EAAE;MACnBN,gBAAgB,EAAEA,gBAAgB;MAClCI,aAAa,EAAEA;KAChB;EACH;;AA3CWxB,wBAAwB;mBAAxBA,wBAAwB;AAAA;AAAxBA,wBAAwB;QAAxBA,wBAAwB;EAAA2B;EAAAC;IAAA;;;;;;;;;;;;;;;;;;;;MDhBrC7B,0EA2BM;MAENA,8BAA0D;MAElDA,uBAAgC;MAACA,gCACrC;MAAAA,iBAAS;MACTA,iCAAwD;MAAxBA;QAAA,OAAS8B,iBAAa;MAAA,EAAC;MACnD9B,8BAAa;MAAAA,uBAAiC;MAClDA,iBAAS;;;MAnCMA,uCAAkB","names":["i0","CheckoutPaymentComponent","constructor","basketService","checkoutService","toastr","router","submitOrder","basket","getCurrentBasketValue","orderToCreate","getOrderToCreate","createOrder","subscribe","next","order","success","deleteLocalBasket","navigationExtras","state","navigate","deliveryMethodId","checkoutForm","get","value","shipToAddress","basketId","id","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["C:\\Users\\olumi\\Desktop\\ECommerce\\client\\src\\app\\checkout\\checkout-payment\\checkout-payment.component.html","C:\\Users\\olumi\\Desktop\\ECommerce\\client\\src\\app\\checkout\\checkout-payment\\checkout-payment.component.ts"],"sourcesContent":["<div class=\"mt-4\" *ngIf=\"checkoutForm\" [formGroup]=\"checkoutForm\">\n    <div class=\"row\">\n        <div class=\"form-group col-12\" formGroupName=\"paymentForm\">\n            <app-text-input [label]=\"'Name on card'\" formControlName=\"nameOnCard\"></app-text-input>\n        </div>\n    </div>\n    <div class=\"row mb-3\">\n        <div class=\"col-6\">\n            <div class=\"form-floating\">\n                <div class=\"form-control\" #cardNumber></div>\n                <label>Card Number</label>\n                <!-- <span class=\"text-danger\">{{cardErrors}}</span> -->\n            </div>\n        </div>\n        <div class=\"col-3\">\n            <div class=\"form-floating\">\n                <div class=\"form-control\" #cardExpiry></div>\n                <label>Card Expiry</label>\n            </div>\n        </div>\n        <div class=\"col-3\">\n            <div class=\"form-floating\">\n                <div class=\"form-control\" #cardCvc></div>\n                <label>Card CVC</label>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class=\"d-flex justify-content-between flex-row mt-3\">\n    <button class=\"btn btn-outline-primary\" cdkStepperPrevious>\n        <i class=\"fa fa-angle-left\"></i> Back to review\n    </button>\n    <button class=\"btn btn-primary\" (click)=\"submitOrder()\">\n        Submit order <i class=\"fa fa-angle-right\"></i> \n    </button>\n</div>","import { Component, ElementRef, Input, ViewChild } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { BasketService } from 'src/app/basket/basket.service';\nimport { CheckoutService } from '../checkout.service';\nimport { ToastrService } from 'ngx-toastr';\nimport { NavigationExtras, Router } from '@angular/router';\nimport { Basket } from 'src/app/shared/models/basket';\nimport { OrderToCreate } from 'src/app/shared/models/order';\nimport { Address } from 'src/app/shared/models/user';\nimport { Stripe, StripeCardCvcElement, StripeCardExpiryElement, StripeCardNumberElement } from '@stripe/stripe-js';\n\n@Component({\n  selector: 'app-checkout-payment',\n  templateUrl: './checkout-payment.component.html',\n  styleUrls: ['./checkout-payment.component.scss']\n})\nexport class CheckoutPaymentComponent {\n  @Input() checkoutForm?: FormGroup;\n  @ViewChild('cardNumber') cardNumberElement?: ElementRef;\n  @ViewChild('cardExpiry') cardExpiryElement?: ElementRef;\n  @ViewChild('cardCvc') cardCvcElement?: ElementRef;\n  stripe: Stripe | null = null;\n  cardNumber?: StripeCardNumberElement;\n  cardExpiry?: StripeCardExpiryElement;\n  cardCvc?: StripeCardCvcElement;\n  cardNumberComplete = false;\n  cardExpiryComplete = false;\n  cardCvcComplete = false;\n  cardErrors: any;\n  loading = false;\n\n\n  constructor(private basketService: BasketService, private checkoutService: CheckoutService,\n    private toastr: ToastrService, private router: Router) { }\n\n  submitOrder() {\n    const basket = this.basketService.getCurrentBasketValue();\n    if (!basket) return;\n    const orderToCreate = this.getOrderToCreate(basket);\n    if(!orderToCreate) return;\n    this.checkoutService.createOrder(orderToCreate).subscribe({\n      next: order => {\n        this.toastr.success('Order created successfully');\n        this.basketService.deleteLocalBasket();\n        const navigationExtras: NavigationExtras = {state: order};\n        this.router.navigate(['checkout/success'], navigationExtras);\n      }\n    })\n  }\n\n  private getOrderToCreate(basket: Basket) {\n    const deliveryMethodId = this.checkoutForm?.get('deliveryForm')?.get('deliveryMethod')?.value;\n    const shipToAddress = this.checkoutForm?.get('addressForm')?.value as Address;\n    if (!deliveryMethodId || !shipToAddress) return;\n    return {\n      basketId: basket.id,\n      deliveryMethodId: deliveryMethodId,\n      shipToAddress: shipToAddress\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}